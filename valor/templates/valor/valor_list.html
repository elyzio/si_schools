{% extends 'main/base.html' %}

{% block contents %}
<div class="card">
    <div class="card-header">
        <h3 class="card-title">{{ page_title }}</h3>
    </div>
    <div class="card-body">
        {% if active_ano %}
        <div class="row mb-3">
            <div class="col-md-12">
                <div class="alert alert-info mb-2">
                    <i class="fas fa-info-circle"></i> Tinan Akadémiku Ativu: <strong>{{ active_ano.ano }}</strong>
                </div>
            </div>
        </div>

        <!-- Period Filter -->
        {% if periodos %}
        <div class="row mb-3">
            <div class="col-md-12 row">
                <h6 class="mx-2 my-1">Períodu:</h6>
                <div class="btn-group btn-group-sm" role="group">
                    {% for periodo in periodos %}
                    <a href="?periodo={{ periodo.id }}{% if dept_filter %}&dept={{ dept_filter }}{% endif %}{% if classe_filter %}&classe={{ classe_filter }}{% endif %}{% if turma_filter %}&turma={{ turma_filter }}{% endif %}"
                       class="btn btn-outline-primary {% if periodo_filter == periodo.id|stringformat:'s' %}active{% endif %}">
                        {{ periodo }}
                    </a>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Department Filter -->
        {% if departments %}
        <div class="row mb-3">
            <div class="col-md-12 row">
                <h6 class="mx-2 my-1">Departamentu:</h6>
                <div class="btn-group btn-group-sm" role="group">
                    <a href="?{% if periodo_filter %}periodo={{ periodo_filter }}{% endif %}" class="btn btn-outline-secondary {% if not dept_filter %}active{% endif %}">
                        <i class="fas fa-th-large"></i> Hotu
                    </a>
                    {% for dept in departments %}
                    <a href="?{% if periodo_filter %}periodo={{ periodo_filter }}&{% endif %}dept={{ dept.departamentu__id }}"
                       class="btn btn-outline-info {% if dept_filter == dept.departamentu__id|stringformat:'s' %}active{% endif %}">
                        {{ dept.departamentu__departamento }}
                        {% if dept.departamentu__sigla %}({{ dept.departamentu__sigla }}){% endif %}
                        <span class="badge badge-light">{{ dept.count }}</span>
                    </a>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Class Filter -->
        {% if dept_filter and classes %}
        <div class="row mb-3">
            <div class="col-md-12 row">
                <h6 class="mx-2 my-1">Klase:</h6>
                <div class="btn-group btn-group-sm" role="group">
                    <a href="?{% if periodo_filter %}periodo={{ periodo_filter }}&{% endif %}dept={{ dept_filter }}" class="btn btn-outline-secondary {% if not classe_filter %}active{% endif %}">
                        <i class="fas fa-th-large"></i> Hotu
                    </a>
                    {% for classe in classes %}
                    <a href="?{% if periodo_filter %}periodo={{ periodo_filter }}&{% endif %}dept={{ dept_filter }}&classe={{ classe.classe__id }}"
                       class="btn btn-outline-success {% if classe_filter == classe.classe__id|stringformat:'s' %}active{% endif %}">
                        {{ classe.classe__classe }}
                        <span class="badge badge-light">{{ classe.count }}</span>
                    </a>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Turma Filter -->
        {% if classe_filter and turmas %}
        <div class="row mb-3">
            <div class="col-md-12 row">
                <h6 class="mx-2 my-1">Turma:</h6>
                <div class="btn-group btn-group-sm" role="group">
                    <a href="?{% if periodo_filter %}periodo={{ periodo_filter }}&{% endif %}dept={{ dept_filter }}&classe={{ classe_filter }}" class="btn btn-outline-secondary {% if not turma_filter %}active{% endif %}">
                        <i class="fas fa-th-large"></i> Hotu
                    </a>
                    {% for turma in turmas %}
                    <a href="?{% if periodo_filter %}periodo={{ periodo_filter }}&{% endif %}dept={{ dept_filter }}&classe={{ classe_filter }}&turma={{ turma.turma__id }}"
                       class="btn btn-outline-warning {% if turma_filter == turma.turma__id|stringformat:'s' %}active{% endif %}">
                        {{ turma.turma__turma }}
                        <span class="badge badge-light">{{ turma.count }}</span>
                    </a>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Students Table -->
        <div class="table-responsive mt-3">
            <table class="table table-striped table-bordered table-hover">
                <thead>
                    <tr>
                        <th>No.</th>
                        <th>EMIS</th>
                        <th>Naran Estudante</th>
                        <th>Sexu</th>
                        <th>Departamentu</th>
                        <th>Klase</th>
                        <th>Turma</th>
                        {% if periodo_filter %}
                        <th>Status Valór</th>
                        {% endif %}
                        <th>Asaun</th>
                    </tr>
                </thead>
                <tbody>
                    {% for ec in estudante_classes %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td>{{ ec.estudante.emis }}</td>
                        <td>{{ ec.estudante.nome }}</td>
                        <td>{{ ec.estudante.get_sexu_display }}</td>
                        <td>{{ ec.departamentu.sigla|default:ec.departamentu.departamento }}</td>
                        <td>{{ ec.classe.classe }}</td>
                        <td>{{ ec.turma.turma }}</td>
                        {% if periodo_filter %}
                        <td class="text-center">
                            {% if ec.has_grades %}
                            <span class="badge badge-success">
                                <i class="fas fa-check"></i> Iha ({{ ec.grades_count }})
                            </span>
                            {% else %}
                            <span class="badge badge-warning">
                                <i class="fas fa-times"></i> Seidauk
                            </span>
                            {% endif %}
                        </td>
                        {% endif %}
                        <td>
                            <a href="{% url 'estudante_valor_detail' ec.pk %}" class="btn btn-info btn-sm" title="Valór">
                                <i class="fas fa-star"></i> Valór
                            </a>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="8" class="text-center">La iha estudante iha klase ida-ne'e.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="alert alert-warning">
            <i class="fas fa-exclamation-triangle"></i> La iha Tinan Akadémiku Ativu!
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
